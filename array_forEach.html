<!--
/*
* COPYRIGHT.GT. ALL RIGHTS RESERVED.
*/
-->

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <script>
        function test() {
            let arr = ["a", "b", "c"]
            arr.forEach(async (item,index) => {
                console.log('循环第'+index+'次')
                const res = await fetch(item)
                console.log('res',res)
                const res1 = await fetch1(res);
                console.log('res1',res1)
            })
            console.log('end')
        }

        function fetch(x,index) {
            return new Promise((resolve, reject) => {
                setTimeout(() => {
                    resolve(x+"经过fetch处理")
                }, 500)
            })
        }

        function fetch1(x) {
            return new Promise((resolve, reject) => {
                setTimeout(() => {
                    resolve(x+" 经过fetch1处理")
                }, 100)
            })
        }

        test()



        function traverse (arr) {
            let i = 0
            let len = arr.length
            return function recursion (d) {
                if (i >= len) return Promise.resolve(d) // 最后一次请求的结果
                let data = arr[i++]
                // let params = { // data是循环的数据，d是上次请求返回的数据
                //   data,
                //   d
                // }
                return new Promise((resolve, reject) => { // promise替换成你的异步请求
                    setTimeout(() => {
                        resolve(data + d)
                    }, 1000)
                }).then(d => { // 处理请求后的数据
                    console.log(d)
                    recursion(d) // 把请求后的数据传给下一次调用
                })
            }
        }

        var arr = [1, 2, 3, 4]
        var fun = traverse(arr)
        //fun(0).then(console)


    </script>
</head>
<body>

</body>
</html>